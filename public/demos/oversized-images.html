<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Feature Policy: oversized-images example</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans">
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="stylesheet" href="/styles/header.css">
</head>

<body class="body-padding">

  <details class="details">
    <!-- filled dynamically -->
  </details>

  <p>When intrinsic_size / container_size ratio exceed threshold given, the image
    will be replace by a placeholder.</p>

  <p>Note: container_size is represented in physical pixel,
    but img element's width/height attribute values are represented in logical pixel.<br>

    size_in_physical_pixel = size_in_logical_pixel * device_pixel_ratio<br>
    This device's pixel ratio: <span id="pixel-ratio"></span></p>

  <div id="height-demo" style="display: block; width: 50%; float:left">
    <ul>
      <li>intrinsic_height = 300</li>
      <li>container_height = <span class="container-size"></span></li>
      <li>ratio = <span class="ratio"></span></li>
    </ul>
    <img src="../img/emilio.jpg" alt="large image" width="400" height="300">
  </div>

  <div id="width-demo" style="display: block; width: 50%; float:left">
    <ul>
      <li>intrinsic_width = 400</li>
      <li>container_width = <span class="container-size"></span></li>
      <li>ratio = <span class="ratio"></span></li>
    </ul>
    <img src="../img/emilio.jpg" alt="large image" width="400" height="300">
  </div>

  <script>
    const pixelRatio = window.devicePixelRatio;
    document.querySelector('#pixel-ratio').textContent = pixelRatio.toPrecision(3);

    const currentThreshold = parseFloat(new URL(location).search.slice(1));
    const step = 0.99;

    function shrinkContainers() {
      let completion = 0;

      for (const [demoId, targetAttr, intrinsicValue] of [
        ['height-demo', 'height', 300],
        ['width-demo', 'width', 400]
      ]) {
        const demoDiv = document.querySelector(`#${demoId}`);
        const img = demoDiv.querySelector('img');
        const containerSizeSpan = demoDiv.querySelector('.container-size');
        const ratioSpan = demoDiv.querySelector('.ratio');

        const oldValue = parseFloat(img.getAttribute(targetAttr));
        const newValue = oldValue * step;
        const ratio = intrinsicValue / (newValue * pixelRatio);

        if (intrinsicValue / (oldValue * pixelRatio) > currentThreshold) {
          completion++;
          continue;
        }

        img.setAttribute(targetAttr, newValue.toString());
        containerSizeSpan.textContent = (newValue * pixelRatio).toPrecision(3);
        ratioSpan.textContent = ratio.toPrecision(3);
      }

      if (completion !== 2)
        window.requestAnimationFrame(shrinkContainers);
    }

    window.requestAnimationFrame(shrinkContainers);
  </script>

  <script type="module">
    import * as shared from '/js/shared.js';

shared.initPage();
</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120357238-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-120357238-1');
  </script>
</body>

</html>